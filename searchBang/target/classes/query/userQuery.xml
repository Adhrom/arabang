<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

	<insert id="insertUser" parameterType="java.util.HashMap">
		INSERT INTO MEMBER_REG(MEMBEREMAIL, MEMBERPW, MEMBERNICKNAME, MEMBERPHONE) VALUES 
		(#{email}, #{password}, #{nickname}, #{phone})
	</insert>

	<select id="loginuser"  resultType="com.mainWeb.searchBang.user.model.UserInfoVO">
		select * from member_reg
		where memberemail = #{memberEmail} and memberpw = #{memberPw}
	</select>

	<select id="accomList" parameterType="java.util.HashMap" resultType="com.mainWeb.searchBang.owner.model.AccomVO">
		select DISTINCT accom.* from accom ,room where accom.ACCOMADDRESS 
		like '%'||#{accomAddress}||'%' and room.ROOMUSINGPEOPLE >= #{roomUsingPeople}
	</select>
	
	<select id="roomList" parameterType="java.util.HashMap" resultType="com.mainWeb.searchBang.owner.model.RoomVO">
		select DISTINCT room.* from accom ,room where accom.ACCOMADDRESS 
		like '%'||#{accomAddress}||'%' and room.ROOMUSINGPEOPLE >= #{roomUsingPeople} and accom.accom_no = room.accom_no
	</select>
	
	<select id="getInfo" parameterType="java.util.HashMap" resultType="com.mainWeb.searchBang.user.model.UserInfoVO">
		SELECT * FROM MEMBER_REG
		WHERE memberemail = #{email} AND membernickname = #{name}
	</select>
	
	<update id="updateInfo" parameterType="java.util.HashMap">
		UPDATE MEMBER_REG SET MEMBERPW = #{password}, MEMBERNICKNAME = #{nickname}, MEMBERPHONE = #{phone}
		WHERE MEMBEREMAIL = #{email}
	</update>
	
	<insert id="insertFavorite" parameterType="java.util.HashMap">
		INSERT INTO FAVORITE VALUES (#{email}, #{accomNo}) 
	</insert>
	
	<select id="favoriteList" parameterType="java.lang.String" resultType="com.mainWeb.searchBang.owner.model.AccomVO">
		select DISTINCT accom.* from accom,favorite where favorite.email = #{email} 
		AND FAVORITE.ACCOMNUM = ACCOM.ACCOM_NO
	</select>

	<select id="accomInfo" resultType="com.mainWeb.searchBang.owner.model.AccomVO">
		select * from accom where accom_no = #{accom_no}
	</select>

	<select id="roomInfoList" resultType="com.mainWeb.searchBang.owner.model.RoomVO">
		select * from room where accom_no = #{accom_no}
	</select>

	<insert id="doReservation">
		insert into reservation values(reservation_no_seq.nextval , #{memberEmail} , #{accom_no} , #{room_no} , to_date(#{checkIn},'YYYY-MM-DD') , to_date(#{checkOut},'YYYY-MM-DD') , 'n' , #{price})
	</insert>

	<update id="pointUpdate">
		update member_reg set point = #{point} where memberemail = #{memberEmail}
	</update>

	<select id="roomCount" resultType="java.lang.Integer">
		select roomcount from room where room_no = #{room_no};
	</select>

	<select id="reservationCount" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		select distinct count(reservation.RESERVATION_NO) from reservation, room where reservation.checkin <![CDATA[ >= ]]> to_date(#{startDate},'YYYY-MM-DD') and reservation.checkout <![CDATA[ <= ]]> to_date(#{endDate},'YYYY-MM-DD') and room.room_no=#{room_no};
	</select>
	
	<delete id="deleteFavorite" parameterType="java.lang.String">
		DELETE FROM favorite WHERE ACCOMNO = #{accomNo}
	</delete>
	
	<insert id="insertReview">
		insert into review values(review_no_seq , #{memberEmail} , #{accom_no} , #{reviewGrade} , #{content} , sysdate , 'n')
	</insert>

	<select id="getUserInfo" resultType="com.mainWeb.searchBang.user.model.UserInfoVO">
		select * from member_reg where memberemail = #{memberEmail}
	</select>

	<select id="roomInfoForReservation" parameterType="java.util.HashMap" resultType="com.mainWeb.searchBang.owner.model.RoomVO">
		select * from room where room_no = #{room_no}
	</select>

	<select id="accomInfoForReservation" resultType="com.mainWeb.searchBang.owner.model.AccomVO">
		select * from accom where accom_no = (select accom_no from room where room_no = #{room_no})
	</select>
</mapper>